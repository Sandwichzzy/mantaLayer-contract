# MantaLayer è´¨æŠ¼åè®®

åŸºäºä»¥å¤ªåŠæ„å»ºçš„å®‰å…¨é«˜æ•ˆçš„è´¨æŠ¼å’Œå§”æ‰˜åè®®ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿè´¨æŠ¼ä»£å¸ã€å§”æ‰˜ç»™è¿è¥å•†å¹¶è·å¾—å¥–åŠ±ã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æ ¸å¿ƒåˆçº¦](#æ ¸å¿ƒåˆçº¦)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [ç´§æ€¥æ§åˆ¶](#ç´§æ€¥æ§åˆ¶)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [æµ‹è¯•](#æµ‹è¯•)

## ğŸŒŸ æ¦‚è¿°

MantaLayer æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–è´¨æŠ¼åè®®ï¼Œå…è®¸ç”¨æˆ·ï¼š

- **è´¨æŠ¼ä»£å¸**åˆ°å¤šç§ç­–ç•¥ä¸­
- **å§”æ‰˜è´¨æŠ¼æƒ**ç»™è¿è¥å•†
- **èµšå–å¥–åŠ±**åŸºäºè´¨æŠ¼å‚ä¸åº¦
- **æå–èµ„é‡‘**é€šè¿‡å®‰å…¨çš„é˜Ÿåˆ—ç³»ç»Ÿ

è¯¥åè®®é‡‡ç”¨ç±» EigenLayer æ¶æ„ï¼Œå¢å¼ºäº†å®‰å…¨ç‰¹æ€§å’Œçµæ´»çš„ææ¬¾æœºåˆ¶ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç­–ç•¥ç®¡ç†   â”‚ â”‚  å§”æ‰˜ç®¡ç†   â”‚ â”‚   å¥–åŠ±ç®¡ç†   â”‚
â”‚   åˆçº¦       â”‚ â”‚  åˆçº¦       â”‚ â”‚   åˆçº¦       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚               â”‚
       â”‚                â”‚               â”‚
       â–¼                â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç­–ç•¥åŸºç¡€   â”‚ â”‚  è¿è¥å•†æ³¨å†Œ â”‚ â”‚   å¥–åŠ±åˆ†å‘   â”‚
â”‚   åˆçº¦       â”‚ â”‚  è¡¨         â”‚ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ ¸å¿ƒåˆçº¦

### 1. **StrategyManager.sol**ï¼ˆç­–ç•¥ç®¡ç†åˆçº¦ï¼‰

ç®¡ç†ç”¨æˆ·å­˜æ¬¾å’Œç­–ç•¥åˆ†é…ã€‚

**æ ¸å¿ƒå‡½æ•°ï¼š**

- `depositIntoStrategy()` - å°†ä»£å¸å­˜å…¥ç­–ç•¥
- `depositIntoStrategyWithSignature()` - é€šè¿‡ EIP-712 ç­¾åå­˜æ¬¾
- `removeShares()` - åœ¨ææ¬¾æ—¶ç§»é™¤ä»½é¢
- `addShares()` - å‘ç”¨æˆ·è´¦æˆ·æ·»åŠ ä»½é¢

**ç‰¹æ€§ï¼š**

- å¤šç­–ç•¥æ”¯æŒï¼ˆæ¯ä¸ªç”¨æˆ·æœ€å¤š 32 ä¸ªç­–ç•¥ï¼‰
- ç­–ç•¥ç™½åå•ç®¡ç†
- ç¬¬ä¸‰æ–¹è½¬è´¦é™åˆ¶
- EIP-712 ç­¾åæ”¯æŒæ—  gas å­˜æ¬¾
- å¯æš‚åœå­˜æ¬¾åŠŸèƒ½ä»¥åº”å¯¹ç´§æ€¥æƒ…å†µ

### 2. **DelegationManager.sol**ï¼ˆå§”æ‰˜ç®¡ç†åˆçº¦ï¼‰

å¤„ç†è´¨æŠ¼è€…å’Œè¿è¥å•†ä¹‹é—´çš„å§”æ‰˜å…³ç³»ã€‚

**æ ¸å¿ƒå‡½æ•°ï¼š**

- `registerAsOperator()` - æ³¨å†Œä¸ºè¿è¥å•†
- `delegateTo()` - å°†è´¨æŠ¼æƒå§”æ‰˜ç»™è¿è¥å•†
- `undelegate()` - ç§»é™¤å§”æ‰˜ï¼ˆè§¦å‘å…¨é¢ææ¬¾ï¼‰
- `queueWithdrawals()` - æ’é˜Ÿéƒ¨åˆ†ææ¬¾
- `completeQueuedWithdrawal()` - å»¶è¿Ÿåå®Œæˆææ¬¾

**ç‰¹æ€§ï¼š**

- è¿è¥å•†æ³¨å†Œï¼Œæ”¯æŒå¯é…ç½®å‚æ•°
- å§”æ‰˜å®¡æ‰¹æœºåˆ¶
- ææ¬¾é˜Ÿåˆ—ç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰å»¶è¿Ÿ
- EIP-712 ç­¾åæ”¯æŒå§”æ‰˜
- ç»†ç²’åº¦æš‚åœæ§åˆ¶ï¼ˆå§”æ‰˜ã€è¿›å…¥é˜Ÿåˆ—ã€é€€å‡ºé˜Ÿåˆ—ï¼‰

### 3. **RewardManager.sol**ï¼ˆå¥–åŠ±ç®¡ç†åˆçº¦ï¼‰

ç®¡ç†å‘è´¨æŠ¼è€…åˆ†å‘å¥–åŠ±ã€‚

**æ ¸å¿ƒå‡½æ•°ï¼š**

- `createRewardDistribution()` - åˆ›å»ºæ–°çš„å¥–åŠ±åˆ†å‘
- `claimReward()` - é¢†å–å·²èµšå–çš„å¥–åŠ±
- `getClaimableReward()` - æŸ¥çœ‹å¯é¢†å–å¥–åŠ±

**ç‰¹æ€§ï¼š**

- åŸºäºæ—¶é—´çš„å¥–åŠ±åˆ†å‘
- åŸºäºä»½é¢çš„æ¯”ä¾‹å¥–åŠ±è®¡ç®—
- Merkle æ ‘éªŒè¯ä»¥æé«˜é¢†å–æ•ˆç‡
- å¥–åŠ±èµ„æ ¼ç™½åå•ç®¡ç†

### 4. **StrategyBase.sol**ï¼ˆç­–ç•¥åŸºç¡€åˆçº¦ï¼‰

è´¨æŠ¼ç­–ç•¥çš„åŸºç¡€å®ç°ã€‚

**æ ¸å¿ƒå‡½æ•°ï¼š**

- `deposit()` - å°†ä»£å¸è½¬æ¢ä¸ºä»½é¢
- `withdraw()` - å°†ä»½é¢è½¬æ¢å›ä»£å¸
- `sharesToUnderlying()` - è®¡ç®—ä»½é¢çš„ä»£å¸ä»·å€¼
- `underlyingToShares()` - ä»ä»£å¸æ•°é‡è®¡ç®—ä»½é¢

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ” å®‰å…¨ç‰¹æ€§

- **é‡å…¥ä¿æŠ¤** - æ‰€æœ‰å¤–éƒ¨å‡½æ•°ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦ä¿æŠ¤
- **å¯æš‚åœç³»ç»Ÿ** - æ¯ä¸ªå‡½æ•°çš„ç»†ç²’åº¦ç´§æ€¥æš‚åœæ§åˆ¶
- **ç­¾åéªŒè¯** - EIP-712 å’Œ EIP-1271 ç­¾åéªŒè¯
- **è®¿é—®æ§åˆ¶** - æ‰€æœ‰è€…å’ŒåŸºäºè§’è‰²çš„æƒé™
- **ææ¬¾å»¶è¿Ÿ** - å¯é…ç½®å»¶è¿Ÿä»¥é˜²æ­¢é—ªç”µæ”»å‡»

### ğŸš€ é«˜çº§åŠŸèƒ½

- **å¯å‡çº§åˆçº¦** - UUPS ä»£ç†æ¨¡å¼ï¼Œä¾¿äºæœªæ¥æ”¹è¿›
- **Gas ä¼˜åŒ–** - ä½¿ç”¨ Yul IR å’Œ 200 æ¬¡ä¼˜åŒ–å™¨è¿è¡Œè¿›è¡Œä¼˜åŒ–
- **å¤šç­–ç•¥æ”¯æŒ** - ç”¨æˆ·å¯ä»¥åŒæ—¶åœ¨å¤šä¸ªç­–ç•¥ä¸­è´¨æŠ¼
- **è¿è¥å•†å§”æ‰˜** - çµæ´»çš„å§”æ‰˜å’Œå®¡æ‰¹æœºåˆ¶
- **EIP-712 ç­¾å** - æ—  gas äº¤æ˜“å’Œå…ƒäº¤æ˜“æ”¯æŒ

### ğŸ“Š çµæ´»ææ¬¾

- **éƒ¨åˆ†ææ¬¾** - æ— éœ€å–æ¶ˆå§”æ‰˜å³å¯æ’é˜Ÿç‰¹å®šé‡‘é¢
- **å…¨é¢ææ¬¾** - å–æ¶ˆå§”æ‰˜ä¼šè‡ªåŠ¨è§¦å‘å…¨é¢ææ¬¾é˜Ÿåˆ—
- **ç­–ç•¥ç‰¹å®šå»¶è¿Ÿ** - æ¯ä¸ªç­–ç•¥çš„ä¸åŒææ¬¾å»¶è¿Ÿ
- **ææ¬¾éªŒè¯** - ææ¬¾å®Œæˆçš„æ ¹å“ˆå¸ŒéªŒè¯

## ğŸ”’ å®‰å…¨æœºåˆ¶

### æš‚åœç³»ç»Ÿ

åè®®å®ç°äº†åŸºäºä½å›¾çš„å¯æš‚åœç³»ç»Ÿï¼Œå…·æœ‰ä¸‰ä¸ªçº§åˆ«ï¼š

#### StrategyManager æš‚åœç´¢å¼•

- **ç´¢å¼• 0** (`PAUSED_DEPOSITS`) - æš‚åœæ‰€æœ‰å­˜æ¬¾åŠŸèƒ½

#### DelegationManager æš‚åœç´¢å¼•

- **ç´¢å¼• 0** (`PAUSED_NEW_DELEGATION`) - æš‚åœæ–°å§”æ‰˜
- **ç´¢å¼• 1** (`PAUSED_ENTER_WITHDRAWAL_QUEUE`) - æš‚åœè¿›å…¥ææ¬¾é˜Ÿåˆ—
- **ç´¢å¼• 2** (`PAUSED_EXIT_WITHDRAWAL_QUEUE`) - æš‚åœå®Œæˆææ¬¾

### ç­¾åå®‰å…¨

- **åŸŸåˆ†éš”ç¬¦** - é“¾ç‰¹å®šï¼Œé˜²æ­¢è·¨é“¾é‡æ”¾æ”»å‡»
- **Nonce è¿½è¸ª** - é˜²æ­¢åŒä¸€é“¾å†…çš„ç­¾åé‡æ”¾
- **è¿‡æœŸæ—¶é—´æˆ³** - æ—¶é—´é™åˆ¶ç­¾åï¼Œå¢å¼ºå®‰å…¨æ€§
- **EIP-1271 æ”¯æŒ** - æ™ºèƒ½åˆçº¦é’±åŒ…å…¼å®¹æ€§

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- [Foundry](https://book.getfoundry.sh/getting-started/installation)
- [Git](https://git-scm.com/)
- [Node.js](https://nodejs.org/)ï¼ˆå¯é€‰ï¼Œç”¨äºé¢å¤–å·¥å…·ï¼‰

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-org/mantaLayer-contract.git
cd mantaLayer-contract

# å®‰è£…ä¾èµ–
forge install

# æ„å»ºåˆçº¦
forge build
```

### ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# ç½‘ç»œ RPC URLs
MAINNET_RPC_URL=https://mainnet.infura.io/v3/YOUR_KEY
SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_KEY

# éƒ¨ç½²é’±åŒ…
PRIVATE_KEY=your_private_key_here

# Etherscan API key ç”¨äºéªŒè¯
ETHERSCAN_API_KEY=your_etherscan_key

# åˆçº¦åœ°å€ï¼ˆéƒ¨ç½²åï¼‰
STRATEGY_MANAGER=0x...
DELEGATION_MANAGER=0x...
REWARD_MANAGER=0x...
```

## ğŸ“ éƒ¨ç½²æŒ‡å—

### 1. éƒ¨ç½²æ ¸å¿ƒåˆçº¦

```bash
# éƒ¨ç½² StrategyManager
forge script script/DeployStrategyManager.s.sol \
    --rpc-url $SEPOLIA_RPC_URL \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --verify

# éƒ¨ç½² DelegationManager
forge script script/DeployDelegationManager.s.sol \
    --rpc-url $SEPOLIA_RPC_URL \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --verify

# éƒ¨ç½² RewardManager
forge script script/DeployRewardManager.s.sol \
    --rpc-url $SEPOLIA_RPC_URL \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --verify
```

### 2. åˆå§‹åŒ–åˆçº¦

```solidity
// åˆå§‹åŒ– StrategyManager
strategyManager.initialize(
    owner,                    // åˆçº¦æ‰€æœ‰è€…åœ°å€
    strategyWhitelister,      // å¯ä»¥å°†ç­–ç•¥åŠ å…¥ç™½åå•çš„åœ°å€
    pauserRegistry,          // PauserRegistry åˆçº¦åœ°å€
    0                        // åˆå§‹æš‚åœçŠ¶æ€ï¼ˆ0 = æœªæš‚åœï¼‰
);

// åˆå§‹åŒ– DelegationManager
delegationManager.initialize(
    owner,                   // åˆçº¦æ‰€æœ‰è€…åœ°å€
    pauserRegistry,         // PauserRegistry åˆçº¦åœ°å€
    0,                      // åˆå§‹æš‚åœçŠ¶æ€
    50400,                  // æœ€å°ææ¬¾å»¶è¿ŸåŒºå—æ•°ï¼ˆçº¦ 7 å¤©ï¼‰
    strategies,             // åˆå§‹ç­–ç•¥æ•°ç»„
    withdrawalDelayBlocks   // æ¯ä¸ªç­–ç•¥çš„ææ¬¾å»¶è¿Ÿ
);

// åˆå§‹åŒ– RewardManager
rewardManager.initialize(
    owner,                  // åˆçº¦æ‰€æœ‰è€…åœ°å€
    strategyManager         // StrategyManager åœ°å€
);
```

### 3. é…ç½®ç³»ç»Ÿ

```solidity
// å°†ç­–ç•¥æ·»åŠ åˆ°ç™½åå•
IStrategyBase[] memory strategies = [strategy1, strategy2];
bool[] memory transferRestrictions = [false, true];
strategyManager.addStrategiesToDepositWhitelist(
    strategies,
    transferRestrictions
);

// ä¸ºç­–ç•¥è®¾ç½®ææ¬¾å»¶è¿Ÿ
delegationManager.setStrategyWithdrawalDelayBlocks(
    strategies,
    [50400, 86400]  // æ¯ä¸ªç­–ç•¥ä¸åŒçš„å»¶è¿Ÿ
);
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### è´¨æŠ¼è€…æ“ä½œ

#### 1. å­˜å…¥ä»£å¸

```solidity
// é¦–å…ˆæˆæƒä»£å¸
token.approve(address(strategyManager), amount);

// å­˜å…¥ç­–ç•¥
strategyManager.depositIntoStrategy(
    strategy,
    token,
    amount
);
```

#### 2. å§”æ‰˜ç»™è¿è¥å•†

```solidity
// å§”æ‰˜ä½ çš„è´¨æŠ¼æƒ
delegationManager.delegateTo(
    operatorAddress,
    emptySignature,  // å¦‚æœè¿è¥å•†æ²¡æœ‰å®¡æ‰¹è€…
    bytes32(0)       // Salt
);
```

#### 3. æ’é˜Ÿææ¬¾

```solidity
// å‡†å¤‡ææ¬¾å‚æ•°
IDelegationManager.QueuedWithdrawalParams[] memory params =
    new IDelegationManager.QueuedWithdrawalParams[](1);

params[0] = IDelegationManager.QueuedWithdrawalParams({
    strategies: strategiesArray,
    shares: sharesArray,
    withdrawer: msg.sender
});

// æ’é˜Ÿææ¬¾
bytes32[] memory roots = delegationManager.queueWithdrawals(params);
```

#### 4. å®Œæˆææ¬¾

```solidity
// ææ¬¾å»¶è¿ŸæœŸå
delegationManager.completeQueuedWithdrawal(
    withdrawal,
    mantaToken
);
```

### è¿è¥å•†æ“ä½œ

#### 1. æ³¨å†Œä¸ºè¿è¥å•†

```solidity
IDelegationManager.OperatorDetails memory details =
    IDelegationManager.OperatorDetails({
        earningsReceiver: revenueAddress,
        delegationApprover: approverAddress,  // æˆ– address(0)
        stakerOptOutWindowBlocks: 50400       // çº¦ 7 å¤©
    });

delegationManager.registerAsOperator(
    details,
    "https://metadata-url.com/operator.json"
);
```

#### 2. æ›´æ–°è¿è¥å•†ä¿¡æ¯

```solidity
delegationManager.modifyOperatorDetails(newDetails);
delegationManager.updateOperatorNodeUrl(newMetadataUrl);
```

## ğŸš¨ ç´§æ€¥æ§åˆ¶

### æš‚åœåŠŸèƒ½

#### æš‚åœå­˜æ¬¾

```solidity
// Pauser è§’è‰²å¯ä»¥æš‚åœå­˜æ¬¾
uint256 pauseStatus = 1 << 0;  // è®¾ç½®ä½ 0
pauserRegistry.pause(pauseStatus);
```

#### æš‚åœå§”æ‰˜

```solidity
// æš‚åœæ–°å§”æ‰˜ï¼ˆä½ 0ï¼‰
uint256 pauseStatus = 1 << 0;
pauserRegistry.pause(pauseStatus);
```

#### æš‚åœææ¬¾

```solidity
// æš‚åœè¿›å…¥ææ¬¾é˜Ÿåˆ—ï¼ˆä½ 1ï¼‰
uint256 pauseEntry = 1 << 1;
pauserRegistry.pause(pauseEntry);

// æš‚åœå®Œæˆææ¬¾ï¼ˆä½ 2ï¼‰
uint256 pauseExit = 1 << 2;
pauserRegistry.pause(pauseExit);

// åŒæ—¶æš‚åœä¸¤è€…
uint256 pauseBoth = (1 << 1) | (1 << 2);
pauserRegistry.pause(pauseBoth);
```

#### æš‚åœæ‰€æœ‰åŠŸèƒ½

```solidity
// ç´§æ€¥æš‚åœæ‰€æœ‰åŠŸèƒ½
pauserRegistry.pauseAll();
```

#### è§£é™¤æš‚åœ

```solidity
// åªæœ‰ unpauser è§’è‰²å¯ä»¥è§£é™¤æš‚åœ
pauserRegistry.unpause(0);  // è§£é™¤æ‰€æœ‰æš‚åœ
```

### è§’è‰²å’Œæƒé™

| è§’è‰²                                         | æƒé™                         |
| -------------------------------------------- | ---------------------------- |
| **Ownerï¼ˆæ‰€æœ‰è€…ï¼‰**                          | æ›´æ”¹è®¾ç½®ï¼Œå‡çº§åˆçº¦           |
| **Pauserï¼ˆæš‚åœè€…ï¼‰**                         | æš‚åœåŠŸèƒ½ï¼ˆåªèƒ½æ·»åŠ æš‚åœï¼‰     |
| **Unpauserï¼ˆè§£é™¤æš‚åœè€…ï¼‰**                   | è§£é™¤æš‚åœåŠŸèƒ½ï¼ˆåªèƒ½ç§»é™¤æš‚åœï¼‰ |
| **Strategy Whitelisterï¼ˆç­–ç•¥ç™½åå•ç®¡ç†å‘˜ï¼‰** | ä»ç™½åå•æ·»åŠ /ç§»é™¤ç­–ç•¥        |
| **Delegation Approverï¼ˆå§”æ‰˜å®¡æ‰¹è€…ï¼‰**        | æ‰¹å‡†å¯¹ç‰¹å®šè¿è¥å•†çš„å§”æ‰˜       |

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ„å»º

```bash
forge build
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
forge test --match-path test/StrategyManager.t.sol

# å¸¦ gas æŠ¥å‘Šè¿è¡Œ
forge test --gas-report

# å¸¦è¯¦ç»†è¾“å‡ºè¿è¡Œ
forge test -vvv
```

### æ ¼å¼åŒ–ä»£ç 

```bash
forge fmt
```

### ä»£ç è¦†ç›–ç‡

```bash
forge coverage
```

### Gas å¿«ç…§

```bash
forge snapshot
```

### æœ¬åœ°å¼€å‘èŠ‚ç‚¹

```bash
# å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹
anvil

# éƒ¨ç½²åˆ°æœ¬åœ°èŠ‚ç‚¹
forge script script/Deploy.s.sol \
    --rpc-url http://127.0.0.1:8545 \
    --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
    --broadcast
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
forge test --match-contract StrategyManagerTest
forge test --match-contract DelegationManagerTest
forge test --match-contract RewardManagerTest
```

### é›†æˆæµ‹è¯•

```bash
forge test --match-contract IntegrationTest
```

### ä¸å˜é‡æµ‹è¯•

```bash
forge test --match-contract InvariantTest
```

### Fork æµ‹è¯•

```bash
forge test --fork-url $MAINNET_RPC_URL --match-contract ForkTest
```

## ğŸ“Š åˆçº¦è§„èŒƒ

### StrategyManager

- **Solidity ç‰ˆæœ¬**: 0.8.30
- **ä¼˜åŒ–å™¨**: å¯ç”¨ï¼ˆ200 æ¬¡è¿è¡Œï¼‰
- **EVM ç‰ˆæœ¬**: Cancun
- **å¯å‡çº§æ€§**: UUPS ä»£ç†
- **ç»§æ‰¿**: Initializable, OwnableUpgradeable, ReentrancyGuard, Pausable

### DelegationManager

- **Solidity ç‰ˆæœ¬**: 0.8.30
- **ä¼˜åŒ–å™¨**: å¯ç”¨ï¼ˆ200 æ¬¡è¿è¡Œï¼‰
- **EVM ç‰ˆæœ¬**: Cancun
- **å¯å‡çº§æ€§**: UUPS ä»£ç†
- **ç»§æ‰¿**: Initializable, OwnableUpgradeable, ReentrancyGuard, Pausable

### å…³é”®å¸¸é‡

```solidity
// StrategyManager
MAX_STAKER_STRATEGY_LIST_LENGTH = 32

// DelegationManager
MAX_WITHDRAWAL_DELAY_BLOCKS = 216000  // çº¦ 30 å¤©
MAX_STAKER_OPT_OUT_WINDOW_BLOCKS = 1296000  // çº¦ 180 å¤©
```

## ğŸ”§ å®ç”¨å‘½ä»¤

### Cast å‘½ä»¤

```bash
# æ£€æŸ¥å­˜å‚¨æ§½
cast storage <CONTRACT_ADDRESS> <SLOT> --rpc-url $RPC_URL

# è°ƒç”¨è§†å›¾å‡½æ•°
cast call <CONTRACT_ADDRESS> "getDeposits(address)" <STAKER_ADDRESS> \
    --rpc-url $RPC_URL

# å‘é€äº¤æ˜“
cast send <CONTRACT_ADDRESS> "depositIntoStrategy(address,address,uint256)" \
    <STRATEGY> <TOKEN> <AMOUNT> \
    --private-key $PRIVATE_KEY \
    --rpc-url $RPC_URL

# è·å– ABI
forge inspect StrategyManager abi > abi/StrategyManager.json

# è·å–å­˜å‚¨å¸ƒå±€
forge inspect StrategyManager storage-layout --pretty
```

## ğŸ“š å…¶ä»–èµ„æº

- [Foundry æ–‡æ¡£](https://book.getfoundry.sh/)
- [Solidity æ–‡æ¡£](https://docs.soliditylang.org/)
- [OpenZeppelin åˆçº¦](https://docs.openzeppelin.com/contracts/)
- [EIP-712 è§„èŒƒ](https://eips.ethereum.org/EIPS/eip-712)
- [EIP-1271 è§„èŒƒ](https://eips.ethereum.org/EIPS/eip-1271)
